Resting state analysis: Stage 2
===

After extracting spectral features from each individual RS epoch within the
BATMAN dataset we aggregated all those features into a single file that 
can be easily imported into R for further analyses:


## Import directives

````
import meegpipe.aggregate;
import mperl.file.find.finddepth_regex_match;
import batman.*;
````

## Aggregation parameters

The input directory is the same as the output directory for [stage 1][st1]
of the resting state analyses:

[st1]: ./stage1.md

````
INPUT_DIR = '/data1/projects/batman/analysis/rs-stage1_gherrero_130827-102715';
````

The names of the files that will be generated by this stage:

````matlab
OUTPUT_FILE = {...
    ['/data1/projects/batman/analysis/rs-stage2_power_ratios' ...
    get_username '_' datestr(now, 'yymmdd-HHMMSS') '.csv'], ...
    ['/data1/projects/batman/analysis/rs-stage2_raw_power' ...
    get_username '_' datestr(now, 'yymmdd-HHMMSS') '.csv'] ...;
    };
````

Note that two different files will be produced. One for the power ratios 
extracted at node 2 of [stage 1][st1], and one for the raw power features
extracted at node 3 of [stage 1][st1].

The following regular expression is used to extract relevant tags from the
names of the input files. Basically, the subject ID and the block ID will 
be extracted from those file names and added to the corresponding rows of 
the files generated by this stage.

````matlab
FILENAME_TRANS = 'batman_(?<subject>\d+)_.+_rs_(?<block>\d+)';
````

## Perform the aggregation

First we need to produce a cell array with the names of all the input files
to [stage 1][st1]:

````matlab
regex = '_stage4.pseth$';
files = finddepth_regex_match(INPUT_DIR, regex);
````

Now we can use function `meegpipe.aggregate` to make the aggregation 
separately for nodes 2 and 3 of [stage 1][st1]:

````matlab
aggregate(files, 'node-02-spectra.+features.txt$', OUTPUT_FILE{1}, ...
    FILENAME_TRANS);

aggregate(files, 'node-03-spectra.+features.txt$', OUTPUT_FILE{2}, ...
    FILENAME_TRANS);
````

